const C=["January","February","March","April","May","June","July","August","September","October","November","December"];self.onmessage=function(w){const{data:m,getCategory:B}=w.data,d={},i={},f={},D=[],l={},g={},u={},p={},r={};let F=0;const A=(o,t)=>{i[o]||(i[o]={}),i[o][t]||(i[o][t]=0),d[t]||(d[t]=[]),l[t]||(l[t]=0),g[t]||(g[t]=0),p[o]||(p[o]={}),p[o][t]||(p[o][t]=0),u[o]||(u[o]=0),f[o]||(f[o]=0)},M=(o,t,e)=>{const{cat:a,sum:s,type:c}=o;c==="incomes"?(u[t]=(u[t]||0)+parseFloat(s),p[t][e]+=parseFloat(s),D.push(o),g[e]=parseFloat(((g[e]||0)+parseFloat(s)).toFixed(2))):c==="transaction"&&(d[e].push(o),l[e]=parseFloat(((l[e]||0)+parseFloat(s)).toFixed(2)),a&&r[a]&&(r[a].name=B[a]||"",r[a].y=parseFloat((r[a].y+parseFloat(s)).toFixed(2))),F=F+parseFloat(s),i[t][e]+=parseFloat(s),f[t]=(f[t]||0)+parseFloat(s))};m&&([...m].sort((t,e)=>{const a=new Date(t.dt).getTime(),c=new Date(e.dt).getTime()-a;if(c!==0)return c;const n=t.cr||new Date(t.dt).getTime();return(e.cr||new Date(e.dt).getTime())-n}).forEach(t=>{const{dt:e,cat:a}=t,s=new Date(e),c=s.getFullYear(),n=`${C[s.getMonth()]} ${c}`;a&&!r[a]&&(r[a]={name:"",y:0}),A(c,n),M(t,c,n)}),Object.keys(d).forEach(t=>{d[t].sort((e,a)=>{const s=new Date(e.dt).getTime(),n=new Date(a.dt).getTime()-s;if(n!==0)return n;const T=e.cr||new Date(e.dt).getTime();return(a.cr||new Date(a.dt).getTime())-T})}),D.sort((t,e)=>{const a=new Date(t.dt).getTime(),c=new Date(e.dt).getTime()-a;if(c!==0)return c;const n=t.cr||new Date(t.dt).getTime();return(e.cr||new Date(e.dt).getTime())-n}));const Y={groupedData:d,totalsPerYearAndMonth:i,totalPerYear:f,incomeData:D,monthsTotals:l,incomeTotals:g,totalIncomePerYear:u,totalIncomePerYearAndMonth:p,categoryTotals:r,totalSpent:F};self.postMessage({...Y,totals:l})};
